---
title: "Rye + VSCode ã§é–‹ç™ºç’°å¢ƒã‚’æ•´ãˆã¦ã¿ã‚‹"
emoji: "ğŸŒ¿"
type: "tech"
topics:
  - "python"
  - "vscode"
  - "rye"
published: true
published_at: "2023-06-11 10:46"
---

æœ€è¿‘è©±é¡Œã®Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ `Rye`
ã“ã®è¨˜äº‹ã§ã¯`Rye + VSCode`ã®é–‹ç™ºç’°å¢ƒã‚’æ•´ãˆã¦ã„ãã¾ã™ã€‚

:::message
ä»Šå›æ§‹ç¯‰ã—ãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€å¼ã¯GitHubã«ã‚³ãƒŸãƒƒãƒˆã—ã¦ã„ã¾ã™ã€‚
:::
https://github.com/nowa0402/rye_template

## æ§‹ç¯‰å‰ã«

### å‰æ

ä»¥ä¸‹ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€‚

- vscode
- Rye

`Rye`ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯å…¬å¼ã‚’å‚ç…§ã€‚

#### Github

https://github.com/mitsuhiko/rye

#### docs

https://rye-up.com/

`Rye`ã®åŸºæœ¬æ“ä½œã¯ä»¥ä¸‹è¨˜äº‹ãŒã‚ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚
https://zenn.dev/watany/articles/f69db9e33d4427

### ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ãƒ»ãƒªãƒ³ã‚¿ãƒ¼

ä»Šå›ã¯ä»¥ä¸‹ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ãƒ»ãƒªãƒ³ã‚¿ãƒ¼ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚

- [mypy](https://github.com/python/mypy)
- [Ruff](https://github.com/astral-sh/ruff)

Ruffã¯flake8ã‚„isortã®æ©Ÿèƒ½ãŒä½¿ç”¨ã§ãã‚‹é™çš„ã‚³ãƒ¼ãƒ‰è§£æãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
https://beta.ruff.rs/docs/

:::message
2023/12/10æ›´æ–° Ruff v0.1.2ä»¥é™ã€blackäº’æ›æ€§ãŒã‚ã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚
ä»¥å‰ã¾ã§Formatterã¯blackã‚’æ¡ç”¨ã—ã¦ã„ã¾ã—ãŸãŒã€Ruffã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«è¨˜äº‹ã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚
:::

#### è¨­å®šè¨˜è¿°æ–¹é‡

`Rye`ã¯`pyproject.toml`ã§ç®¡ç†ã‚’ã—ã¦ã„ã¾ã™ã€‚
ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ãƒ»ãƒªãƒ³ã‚¿ãƒ¼ã®è¨­å®šã¯`pyproject.toml`ã«å¯èƒ½ãªé™ã‚Šè¨˜è¿°ã—ã¾ã—ãŸã€‚

----

## æ§‹ç¯‰

`rye init {project_name}`ã§åˆæœŸåŒ–ã—ãŸä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‹ã‚‰é€²ã‚ã¾ã™ã€‚

```bash
.
â”œâ”€â”€ README.md
â”œâ”€â”€ pyproject.toml
â””â”€â”€ src
    â””â”€â”€ {project_name}
        â””â”€â”€ __init__.py
```

å¿…è¦ãªãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ãƒ»ãƒªãƒ³ã‚¿ãƒ¼ã‚’é–‹ç™ºãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚

```bash
rye add --dev mypy ruff
```

å¤‰æ›´å†…å®¹ã‚’ç’°å¢ƒã«åæ˜ ã•ã›ã¾ã™ã€‚

```bash
rye sync
```

`requirements-dev.lock`,`requirements.lock`, `.venv`ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

```bash
.
â”œâ”€â”€ .venv
â”œâ”€â”€ README.md
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ requirements-dev.lock
â”œâ”€â”€ requirements.lock
â””â”€â”€ src
    â””â”€â”€ {project_name}
        â””â”€â”€ __init__.py
```

ã“ã®çŠ¶æ…‹ã‹ã‚‰`vscode`ã®è¨­å®šã‚„`pyproject.toml`ã®è¨­å®šã®è¨˜è¿°ã‚’è¡Œã„ã¾ã™ã€‚

## VSCodeå´ã®è¨­å®š

### æ‹¡å¼µæ©Ÿèƒ½

å¿…è¦ãªæ‹¡å¼µæ©Ÿèƒ½ã‚’å…¥ã‚Œã¾ã™ã€‚

#### å¿…é ˆ

ä»Šå›ã®æ§‹ç¯‰ã§å¿…é ˆã®æ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚

| Name    | ID                         |
| ------- | -------------------------- |
| [Python](https://marketplace.visualstudio.com/items?itemName=ms-python.python)  | `ms-python.python`         |
| [Pylance](https://marketplace.visualstudio.com/items?itemName=ms-python.vscode-pylance) | `ms-python.vscode-pylance` |
| [Ruff](https://marketplace.visualstudio.com/items?itemName=charliermarsh.ruff) | `charliermarsh.ruff` |
| [Mypy](https://marketplace.visualstudio.com/items?itemName=matangover.mypy) | `matangover.mypy` |

#### æ¨å¥¨

å¿…é ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã‚ã‚‹ã¨ä¾¿åˆ©ãªæ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚

| Name             | ID                         |
| ---------------- | -------------------------- |
| [autodocstring](https://marketplace.visualstudio.com/items?itemName=njpwerner.autodocstring)    | `njpwerner.autodocstring`  |
| [even-better-toml](https://marketplace.visualstudio.com/items?itemName=tamasfe.even-better-toml) | `tamasfe.even-better-toml` |

`even-better-toml`ã¯`pyproject.toml`ã®è¨˜è¿°ã§å½¹ç«‹ã¡ã¾ã™ã€‚

### settings.json

`settings.json`ã«è¨­å®šã‚’è¨˜è¿°ã—ã¾ã™ã€‚
ãƒ«ãƒ¼ãƒ©ãƒ¼ã®æ”¹è¡Œæ–‡å­—æ•°ã«åˆã‚ã›ã¦è¨­å®šã—ã¦ã‚‚ã‚‰ãˆã°è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

```js:.vscode/settings.json

{
  // ãƒ«ãƒ¼ãƒ©ãƒ¼
  "editor.rulers": [80, 88],

  // python path
  "python.defaultInterpreterPath": "${workspaceFolder}/.venv/bin/python",

  "[python]": {
    "editor.codeActionsOnSave": {
      // isortã®ä¸¦ã³æ›¿ãˆã‚’Ruffã§å®Ÿè¡Œ
      "source.organizeImports": true
    },
    // Ruffã®Formatteræ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹
    "editor.defaultFormatter": "charliermarsh.ruff",
    "editor.formatOnSave": true
  },

  // æ‹¡å¼µæ©Ÿèƒ½ã§ã¯ãªãã€pip install ã—ãŸå ´åˆã«æŒ‡å®šã—ã¦ãã ã•ã„
  "ruff.path": ["${workspaceFolder}/.venv/bin/ruff"],
  "mypy-type-checker.path": ["${workspaceFolder}/.venv/bin/mypy"]
}

```

:::message
Windowsã¯`"${workspaceFolder}/.venv/Scripts/..."`ã«ãªã‚‹ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
:::

è¨˜è¿°å†…å®¹ã‚’è¦‹ã¦ã„ãŸã ã‘ã‚Œã°åˆ†ã‹ã‚‹ã¨æ€ã„ã¾ã™ãŒã€`settings.json`ã«ã¯å„ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ãƒ»ãƒªãƒ³ã‚¿ãƒ¼ã®è©³ç´°è¨­å®šã‚’è¨˜è¿°ã—ã¦ã„ã¾ã›ã‚“ã€‚
æ¬¡é …ã®`pyproject.toml`ã«è¨˜è¼‰ã—ã¦ã„ãã¾ã™ã€‚

## pyproject.tomlå´ã®è¨­å®š

`pyproject.toml`ã«å„è©³ç´°è¨­å®šã‚’è¨˜è¿°ã—ã¾ã™ã€‚
å¿…è¦ãã†ãªé …ç›®ã‚’åˆ—æŒ™ã—ã¾ã—ãŸã€‚
Ruffã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ«ãƒ¼ãƒ«](https://beta.ruff.rs/docs/rules/)ã‹ã‚‰ä½¿ç”¨ã™ã‚‹ã‚‚ã®ã ã‘ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸã€‚
ä½•ã‚’è¨­å®šã—ãŸã‚‰è‰¯ã„ã‹è¿·ã£ãŸã‚‰ä¸‹è¨˜ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ãã ã•ã„ã€‚

```toml:pyproject.toml

[project]
name = "my_project"
version = "0.1.0"
description = "Add a short description here"
authors = []
dependencies = []
requires-python = ">= 3.8"

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.rye]
managed = true
dev-dependencies = [
    "mypy",
    # blackäº’æ›ã®formatterãŒ0.1.2ä»¥é™
    "ruff>=0.1.2"
]

[tool.hatch.metadata]
allow-direct-references = true

[tool.mypy]
strict = true
ignore_missing_imports = true
disallow_untyped_decorators = false
disallow_untyped_calls = false

[tool.ruff]
select = [
    "F", # pyflakes
    "E", # pycodestyle
    "W", # pycodestyle warnings
    "I", # isort
    "D", # pydocstyle
]
ignore = []
# 1è¡Œã®æœ€å¤§æ–‡å­—æ•°
line-length = 88

extend-ignore = [
    "D105", # undocumented-magic-method
    "D107", # undocumented-public-init
    "D205", # blank-line-after-summary
    "D415" # ends-in-punctuation
]

[tool.ruff.lint.pydocstyle]
# docstringã‚’google styleã«ã™ã‚‹
convention = "google"

[tool.ruff.per-file-ignores]
# å€‹åˆ¥è¨­å®š
# __init__.pyã¯æœªä½¿ç”¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’è¨±å®¹
"__init__.py" = ["F401"]

```

### è¨­å®šåæ˜ 

è¨­å®šè¨˜è¿°å¾Œã€`vscode`ã®ç”»é¢ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚Œã°åæ˜ ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ï¼
![sample](https://storage.googleapis.com/zenn-user-upload/689f8063b49c-20230611.gif)

ä»Šå›æ§‹ç¯‰ã—ãŸè¨­å®šã®æœ€çµ‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã§ã™ã€‚

```bash
.
â”œâ”€â”€ .vscode
â”‚ â””â”€â”€ settings.json
â”œâ”€â”€ .venv
â”œâ”€â”€ README.md
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ requirements-dev.lock
â”œâ”€â”€ requirements.lock
â””â”€â”€ src
    â””â”€â”€ {project_name}
        â””â”€â”€ __init__.py

```

ä»¥ä¸Šã§è¨­å®šå®Œäº†ã§ã™ã€‚ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ï¼

## å‚è€ƒæ–‡çŒ®

- [å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://rye-up.com/)
- [Ruffå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://beta.ruff.rs/docs/)
- [ä¹…ã—ã¶ã‚Šã®Pythonç’°å¢ƒã‚’Ryeã§æ•´ãˆã‚‹](https://zenn.dev/watany/articles/f69db9e33d4427)
- [VSCode + Python ã®è¨­å®šãŒå£Šã‚Œã¦ã„ãŸï¼Ÿã®ã§ã„ã„æ„Ÿã˜ã«ã—ãŸã¨ãã®ãƒ¡ãƒ¢](https://zenn.dev/odan/scraps/9e878ddbaaca7b)
